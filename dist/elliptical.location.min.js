!function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):(t.elliptical.url=e(),t.returnExports=t.elliptical.url)}(this,function(){function t(t,e){var n={},o=n.toString.call(t).charAt(8);return"R"===o?t.test(e):"F"===o?t(e):t==e}var e,n=/[\-\[\]{}()+?.,\\\^$|#\s]/g,o=/([:*])(\w+)/g;return e={match:function(e,i){var r={},a=[],s=e;return"string"==typeof e?(s=s.replace(n,"\\$&"),s=s.replace(o,function(t,e,n){return a.push(n),":"===e?"([^/]*)":"(.*)"}),s=new RegExp("^"+s+"$"),r.parse=function(e){var n,o,r=0,u={},c=e.match(s);if(!c)return null;for(;r<a.length;){if(n=a[r++],o=c[r],i&&n in i&&!t(i[n],o))return null;u[n]=decodeURIComponent(o)}return u},r.stringify=function(t){var n,i,r=e;for(n in t)i=new RegExp("[:*]"+n+"\\b"),r=r.replace(i,t[n]);return r.replace(o,"")}):(r.parse=function(t){var e=t.match(s);return e&&{captures:e.slice(1)}},r.stringify=function(){return""}),r},sanitize:function(t){var e,n;return e=t.toString().replace(/^(.*\/\/[^\/?#]*).*$/,"$1"),n=e.indexOf("://")>-1?t.replace(e,""):e,n.length>1&&"/"===n.charAt(n.length-1)&&(n=n.slice(0,-1)),n},queryString:function(t,e){var n;if("undefined"==typeof e&&"undefined"!=typeof window?(n=window.location.search.substring(1),e=t):n=t.split("?")[1],"undefined"!=typeof n){var o=n.split("&");for(i=0;i<o.length;i++){var r=o[i].split("=");if(r[0]==e)return r[1]}}return null},query:function(t){var e={},n=t.split("?")[1];if("undefined"!=typeof n){var o=n.split("&");for(i=0;i<o.length;i++){var r=o[i].split("=");e[r[0]]=r[1]}}return e},httpValueCollection:function(t){var e=this.query(t),n=[];for(var o in e)if(e.hasOwnProperty(o)){var i={key:o,value:decodeURIComponent(e[o])};n.push(i)}return n},httpRequestObject:function(t,e){e=e?e:location.pathname;var n=this.match(t);return n.parse(e)},body:function(t){var e={};return t.forEach(function(t){e[t.name]=t.value}),e},hashTagFormat:function(t){return"#"!==t.charAt(1)?"/#"+t:t},pathComponent:function(t){var e=t.split("?");return e[0]}}}),function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e(require("elliptical-utils"),require("./url")):"function"==typeof define&&define.amd?define([t,"elliptical-utils","./url"],e):(t.elliptical.Location=e(t.elliptical.utils,t.elliptical.url),t.returnExports=t.elliptical.Location)}(this,function(t,e){var n=t.string,o="/",i="#",r={"@resource":"Location",stateObject:null,get hashTag(){var t=window.elliptical.$hashTag;return void 0===t?!1:t},get virtualRoot(){var t=window.elliptical.$virtualRoot;return void 0===t?o:t},hashify:function(t){var e=this.virtualRoot,r=e!==o;if(this.hashTag&&r){0!==t.indexOf(e)&&(t=e+t);var a=e.length;t.charAt(a+1)!==i&&(t=n.insertAt(t,a,"/#"))}else this.hashTag?t.charAt(1)!==i&&(t="/#"+t):r&&0!==t.indexOf(e)&&(t=e+t);return t},deHashify:function(t){var e=this.virtualRoot;return e!==o&&0===t.indexOf(e)&&(t=t.replace(e,"")),this.hashTag&&t.charAt(1)===i&&(t=t.substring(2)),t},hashRoot:function(t){return this.hashTag&&t.slice(-1)===i&&(t+=o),t},get path(){var t,e=this.hashTag,n=this.virtualRoot;return e?(t=location.hash,t.charAt(0)===i&&(t=t.substring(1)),""===t&&(t=o),t=this.toPath(t)):(t=location.pathname,n!==o&&0===t.indexOf(n)&&(t=t.replace(n,""))),t},get href(){var t=location.origin,e=this.path,n=this.search;return t+e+n},set href(t){this.redirect(t)},get query(){var t=this.href;return e.query(t)},get search(){if(this.hashTag){var t=location.hash,e=t.length,n=t.indexOf("?");return n>-1?t.substring(n,e):""}return location.search},set search(t){if(this.hashTag){var e=location.hash,o=e.indexOf("?");o>-1?(e=n.replaceAt(e,o,t),location.hash=e):location.hash+=t}else location.search=t},getQuery:function(t){return e.query(t)},setQuery:function(t,n){var o=this.search;if(""!==o){var i=this.href,r=e.queryString(i,t);r?o=o.replace(t+"="+r,t+"="+n):o+="&"+t+"="+encodeURIComponent(n)}else o+="?"+t+"="+encodeURIComponent(n);return o},toPath:function(t){var e=t.split("?");return e[0]},get referrer(){return this.stateObject?this.stateObject.url:void 0},redirect:function(t){location.href=t},reload:function(){location.reload()},url:e,host:location.host,hostname:location.hostname,origin:location.origin,protocol:location.protocol,port:location.port};return r}),function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e(require("elliptical-utils"),require("elliptical-class"),require("./location"),require("./url")):"function"==typeof define&&define.amd?define(["elliptical-utils","elliptical-class","./location","./url"],e):(t.Elliptical.Router=e(elliptical.utils,elliptical.Class,elliptical.Location,elliptical.url),t.returnExports=t.Elliptical.Router)}(this,function(t,e,n,o){function r(t,e){var n=!1;for(i=0;i<t.length;i++)if(t[i]===e){n=!0;break}return n}var a=t.string,s="ontouchend"in document,u=s?"touchstart":"click",c=e.extend({events:{request:"OnDocumentRequest",click:"touchclick",orientation:"OnOrientationChange",press:u},backButtonSelector:'[data-role="back"]',on:function(){$(window).on(this.events.request,this.forward.bind(this)),$(document).on(this.events.press,this.backButtonSelector,f.history),$(window).on(this.events.orientation,this.forward.bind(this))},off:function(){$(window).off(this.events.request,this.forward.bind(this)),$(document).off(this.events.press,this.backButtonSelector,f.history),$(window).off(this.events.orientation,this.forward.bind(this))},reset:function(){this.off(),this.on()},forward:function(t,e){var n=e.route,o={},i=e.method;void 0===i&&(i="get"),f.location(n,i,o)}},{}),h=e.extend({popEvent:"OnDocumentHistory",stateObject:null,poppedDelay:700,pushHistory:!1,push:function(){if(this.pushHistory){var t=this.stateObject,e="";t.url=n.href,t.route=n.hashify(t.route),"#"===a.lastChar(t.route)&&(t.route+="/"),n.stateObject=t,window.history.pushState(t,e,t.route)}},pop:function(t){var e=this;if(t.originalEvent.state){var n=t.originalEvent.state.route,o=t.originalEvent.state.params,i=t.originalEvent.state.method;this.pushHistory=!1,s?setTimeout(function(){l.location(n,i,o),e.dispatchEvent(n,i,o)},e.poppedDelay):(l.location(n,i,o),this.dispatchEvent(n,i,o))}},dispatchEvent:function(t,e,o){n.hashTag&&0===t.indexOf("/#")&&(t=t.substr(2,t.length-2));var i={route:t,url:n.href,method:e,data:o},r=document.createEvent("CustomEvent");r.initCustomEvent(this.popEvent,!0,!0,i),document.dispatchEvent(r)},start:function(){var t=this,e=n.path,o=n.search,i=n.href,r="get",a={route:e,params:o,method:r,url:i};this.stateObject=a,n.stateObject=a,this.pushHistory=!0,setTimeout(function(){n.redirect(location.href)},300),$(window).on("popstate",function(e){t.pop(e)})},end:function(){var t=this;this.stateObject=null,n.stateObject=null,this.pushHistory=!1,$(window).off("popstate",function(e){t.pop(e)})}},{}),l=e.extend({dispatchEvent:"OnRouteDispatch",add:function(t,e,n){if(this.verify(e,t)){var o={route:e,method:t,handle:n};if(f.routes.push(o),f.debug){var i="route: "+e+" has been added. Method: "+t;f.enabled?console.log(i):f.messageQueue.push(i)}}},remove:function(t,e){var n=-1;f.routes.forEach(function(o,i){var r=o.route,a=o.method;t===r&&e===a&&(n=i)}),n>-1&&(f.routes.splice(n,1),f.debug&&console.log("route: "+t+" has been removed"))},verify:function(t,e){var n=!0;return f.routes.every(function(o){var i=o.route,r=o.method;t===i&&e===r&&(n=!1)}),n},decodeUrl:function(t){return decodeURIComponent(t.replace(/\+/g,"%20"))},deserialize:function(t){for(var e=t.split("&"),n=[],o=0;o<e.length;o++){var i=this.decodeUrl(e[o]).split("="),r=i[0],a=i[1],s={name:r,value:a};n.push(s)}return n},location:function(t,e,o){if(t=n.deHashify(t),""===t&&(t="/"),h.push(),!this.dispatch(t,e,o)){var i=[];i.push(this.error);var r={route:t,handlers:i};Event.emit(this.dispatchEvent,r)}},dispatch:function(t,e,i){var r=this,a=this.dispatchEvent,s=!1,u=f.routes,c=t;return t=t.toLowerCase(),u.forEach(function(i,u){var h={},l={},f=i.route;f=f.toLowerCase();var d=n.toPath(t),p=o.match(f),v=p.parse(d);if(null!=v&&i.method.toLowerCase()===e.toLowerCase()&&!s){"get"!=e.toLowerCase()&&(h=o.body(v)),l=o.query(c);var g=[],m=r.next(v,h,l,d);g.push(m);for(var b=i.handle,y=0;y<b.length;y++)g.push(b[y]);var w={route:d,handlers:g};Event.emit(a,w),$(window).trigger("LocationChange",d),s=!0}}),s},next:function(t,e,n,o){return function(i,r,a){r.statusCode=200,i.params=t,i.query=n,i.route=o,i.body=e,a()}},error:function(t,e,n){e.statusCode=404;n()}},{}),f=e.extend({"@resource":"Router",validMethods:["get","post","put","delete"],enabled:!1,debug:!0,callbacks:[],routes:[],virtualRoot:"/",hashTag:!1,messageQueue:[],get:function(t,e){this.parseMethod("get",t,e)},post:function(t,e){this.parseMethod("post",t,e)},put:function(t,e){this.parseMethod("put",t,e)},"delete":function(t,e){this.parseMethod("delete",t,e)},parseMethod:function(t,e,n){if(!r(this.validMethods,t))return!1;var o=[];"string"!=typeof e&&(e="/"),"/"===a.lastChar(e)&&e.length>1&&(e=a.trimLastChar(e));for(var i=Array.prototype.slice.call(arguments,0),s=0;s<i.length;s++)"function"==typeof i[s]&&o.push(i[s]);i.length<1?console.log('error adding route: "'+e+'".  A route must have at least one handler function.'):l.add(t,e,o)},remove:function(t,e){return this.enabled?void l.remove(t,e):!1},removeAll:function(){var t=this;return this.enabled?void this.routes.forEach(function(e){t.remove(e.route,e.method)}):!1},location:function(t,e,i,r){if(!this.enabled)return!1;"undefined"==typeof i&&(i={}),t=o.sanitize(t),t=n.hashRoot(t);var a={route:t,params:i,method:e,url:n.href};h.stateObject=a,h.pushHistory=!0,"undefined"!=typeof r?setTimeout(function(){l.location(t,e,i)},r):l.location(t,e,i)},start:function(){if(this.enabled)return!1;if(this.enabled=!0,h.start(),c.on(),this.debug){var t="Router has started in debug mode";console.log(t),this.messageQueue.forEach(function(t){console.log(t)}),this.messageQueue.length=0}},pause:function(){this.enabled=!1,c.off()},resume:function(){this.enabled=!1,c.on()},history:function(t,e){"undefined"!=typeof e?setTimeout(function(){"undefined"==typeof t?window.history.back():window.history.go(t)},e):"undefined"==typeof t?window.history.back():window.history.go(t)},end:function(){this.enabled=!1,this.routes=[],h.end(),c.off()},$provider:function(t,e){"string"==typeof t?l.dispatchEvent=e:"undefined"!=typeof t&&(Event=t,"string"==typeof e&&(l.dispatchEvent=e))},configure:function(t){t.request&&(c.events.request=t.request),t.orientation&&(c.events.orientation=t.orientation),t.click&&(c.events.click=t.click),t.backButtonSelector&&(c.backButtonSelector=t.backButtonSelector),t.dispatchEvent&&(l.dispatchEvent=t.dispatchEvent),c.reset()}},{});return f.History=h,f});